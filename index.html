<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ü•î Potato Benchmark ‚Äî MongoDB vs Redis</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #050510;
      --surface: rgba(26, 26, 46, 0.7);
      --surface-2: rgba(22, 33, 62, 0.8);
      --mongo: #00ed64;
      --mongo-idx: #00ffcc;
      --redis: #ff4438;
      --text: #ffffff;
      --text-muted: #b0b0d0;
      --accent: #00f3ff;
      --border: rgba(0, 243, 255, 0.2);
      --glow: 0 0 10px var(--accent), 0 0 20px var(--accent);
    }

    body.cyber-neon {
      --bg: #000000;
      --surface: rgba(10, 10, 30, 0.85);
      --accent: #ff00ff;
      --border: rgba(255, 0, 255, 0.4);
    }
    
    body.potato-glitch {
      --bg: #2d1b0d;
      --accent: #f39c12;
      --border: rgba(243, 156, 18, 0.5);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.5s ease;
    }

    #canvas-bg {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .header {
      padding: 4rem 1rem;
      text-align: center;
      position: relative;
    }
    
    .glitch {
      font-size: clamp(2rem, 8vw, 3.5rem);
      font-weight: 800;
      text-transform: uppercase;
      position: relative;
      text-shadow: 0.05em 0 0 #ff00ff, -0.05em -0.025em 0 #00ffff, 0.025em 0.05em 0 #39ff14;
      animation: glitch 1s infinite;
      margin-bottom: 0.5rem;
    }
    
    @keyframes glitch {
      0%, 14%, 49%, 99%, 100% { text-shadow: 0.05em 0 0 #ff00ff, -0.05em -0.025em 0 #00ffff, 0.025em 0.05em 0 #39ff14; }
      15% { text-shadow: -0.05em -0.025em 0 #ff00ff, 0.025em 0.025em 0 #00ffff, -0.05em -0.05em 0 #39ff14; }
      50% { text-shadow: 0.025em 0.05em 0 #ff00ff, 0.05em 0 0 #00ffff, 0 -0.05em 0 #39ff14; }
    }

    .theme-switch {
      position: absolute;
      top: 1rem; right: 1rem;
      display: flex; gap: 0.5rem;
      z-index: 200;
    }
    .theme-btn {
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.65rem;
      font-weight: 800;
      text-transform: uppercase;
      transition: all 0.3s;
    }
    .theme-btn:hover { box-shadow: var(--glow); transform: scale(1.05); }

    .main {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1.5rem 4rem;
    }

    .tabs-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2.5rem;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.5rem;
      border-radius: 50px;
      border: 1px solid var(--border);
      width: fit-content;
      margin-left: auto;
      margin-right: auto;
      backdrop-filter: blur(10px);
    }
    .tab-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      padding: 0.6rem 1.2rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      border-radius: 25px;
      transition: all 0.3s;
      font-size: 0.75rem;
    }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active {
      background: var(--accent);
      color: #000;
      box-shadow: var(--glow);
    }

    /* Dev Vlog Styles */
    .vlog-timeline {
      position: relative;
      padding-left: 2rem;
      border-left: 2px solid var(--border);
      margin-top: 2rem;
    }
    .vlog-entry {
      position: relative;
      margin-bottom: 3rem;
      background: var(--surface-2);
      border: 1px solid var(--border);
      padding: 1.5rem;
      border-radius: 16px;
      transition: all 0.3s;
    }
    .vlog-entry:hover {
      transform: translateX(10px);
      box-shadow: var(--glow);
    }
    .vlog-entry::before {
      content: '';
      position: absolute;
      left: -2.6rem;
      top: 1.5rem;
      width: 1rem;
      height: 1rem;
      background: var(--accent);
      border-radius: 50%;
      box-shadow: var(--glow);
    }
    .vlog-date {
      font-size: 0.7rem;
      color: var(--accent);
      font-weight: 800;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
      display: block;
    }
    .vlog-entry h3 {
      font-size: 1.2rem;
      margin-bottom: 0.8rem;
    }
    .vlog-entry p {
      font-size: 0.9rem;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .report-wrap {
      background: var(--surface);
      backdrop-filter: blur(15px);
      border: 1px solid var(--border);
      padding: 2.5rem;
      border-radius: 24px;
      box-shadow: 0 0 50px rgba(0, 0, 0, 0.2);
    }
    
    .report-wrap h1 { font-size: 1.8rem; margin-bottom: 1rem; }
    .report-wrap h2 { font-size: 1.4rem; margin-top: 2.5rem; margin-bottom: 1rem; color: var(--accent); }

    .scenario-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .scenario-card {
      background: var(--surface);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      padding: 1.5rem;
      border-radius: 16px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .scenario-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); }
    
    .scenario-card h3 { font-size: 1rem; color: var(--accent); margin-bottom: 0.5rem; }
    .scenario-card .desc { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1.5rem; }
    .scenario-card .chart-wrap { height: 200px; }

    .chart-container { height: 400px; margin-top: 1rem; }
    .report-chart-box { height: 350px; margin: 2rem 0; }

    .analysis-box {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }
    .analysis-box h4 { color: var(--accent); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }

    .decision-matrix { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem; }
    
    .highlight { color: var(--accent); font-weight: 600; text-shadow: 0 0 5px var(--accent); }
    .winner-tag {
      display: inline-block; margin-top: 1rem; padding: 0.3rem 0.8rem;
      border-radius: 20px; font-size: 0.7rem; font-weight: 800; text-transform: uppercase;
    }
    .winner-mongo { background: rgba(0, 237, 100, 0.15); color: var(--mongo); }
    .winner-mongoIdx { background: rgba(0, 255, 204, 0.15); color: var(--mongo-idx); }
    .winner-redis { background: rgba(255, 68, 56, 0.15); color: var(--redis); }

    .table-section { overflow-x: auto; margin-top: 3rem; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th { text-align: left; padding: 1rem; font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); border-bottom: 1px solid var(--border); }
    td { padding: 1rem; font-size: 0.85rem; border-bottom: 1px solid var(--border); }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 1.5rem;
      border-radius: 16px;
      text-align: center;
      flex: 1;
      min-width: 120px;
    }
    .stats-bar { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem; }
    .stat-card .value { display: block; font-size: 1.5rem; font-weight: 800; color: var(--accent); }
    .stat-card .label { font-size: 0.6rem; text-transform: uppercase; color: var(--text-muted); }

    @media (max-width: 768px) {
      .decision-matrix { grid-template-columns: 1fr; }
      .tabs-nav { gap: 0.5rem; padding: 0.4rem; }
      .tab-btn { padding: 0.5rem 0.8rem; font-size: 0.65rem; }
      .header { padding: 2.5rem 1rem; }
      .theme-switch { position: static; justify-content: center; margin-bottom: 1rem; }
    }

    /* Subtle Sectional Glitch Style */
    .report-wrap h1, .report-wrap h2, .overview-section h2, .table-section h2 {
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
    }
    
    .report-wrap h1:hover, .report-wrap h2:hover {
      animation: glitch-subtle 0.5s infinite;
    }

    @keyframes glitch-subtle {
      0% { text-shadow: 0.03em 0 0 #ff00ff, -0.03em -0.015em 0 #00ffff, 0.015em 0.03em 0 #00ed64; }
      50% { text-shadow: -0.03em -0.015em 0 #ff00ff, 0.015em 0.015em 0 #00ffff, -0.03em -0.03em 0 #00ed64; }
      100% { text-shadow: 0.03em 0 0 #ff00ff, -0.03em -0.015em 0 #00ffff, 0.015em 0.03em 0 #00ed64; }
    }

    /* Resource Analysis Styles */
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    .resource-card {
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 1.5rem;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .resource-card h3 { color: var(--accent); font-size: 1.1rem; }
    .resource-gauge-wrap { height: 180px; }
    .resource-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      font-size: 0.8rem;
    }
    .metric-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.5rem;
      border-radius: 8px;
    }
    .metric-label { display: block; color: var(--text-muted); font-size: 0.65rem; text-transform: uppercase; }
    .metric-value { display: block; font-weight: 700; color: #fff; }
  </style>
</head>
<body>
<canvas id="canvas-bg"></canvas>

<div class="header">
  <div class="theme-switch">
    <button class="theme-btn" onclick="setTheme('default')">Basic</button>
    <button class="theme-btn" onclick="setTheme('cyber-neon')">Cyber</button>
    <button class="theme-btn" onclick="setTheme('potato-glitch')">Potato</button>
  </div>
  <h1 class="glitch">ü•î Potato Benchmark</h1>
  <p>Analyse NoSQL de Haute Voltige & Performance Radicale</p>
</div>

<div class="tabs-nav">
  <button class="tab-btn active" id="btn-report" onclick="switchTab('report')">üìñ Rapport d'Analyse</button>
  <button class="tab-btn" id="btn-ai" onclick="switchTab('ai')">ü§ñ IA Pr√©dictive</button>
  <button class="tab-btn" id="btn-benchmark" onclick="switchTab('benchmark')">üìä Run Actuel (45M)</button>
  <button class="tab-btn" id="btn-history" onclick="switchTab('history')">üï∞Ô∏è Historique (500k)</button>
  <button class="tab-btn" id="btn-resources" onclick="switchTab('resources')">üîã Ressources</button>
  <button class="tab-btn" id="btn-devlog" onclick="switchTab('devlog')">üé¨ Dev Vlog</button>
</div>

<div id="report-tab" class="tab-content active">
  <div class="main">
    <div class="report-wrap">
      <h1>üìã √âtude Comparative : MongoDB vs Redis</h1>
      
      <div class="analysis-box" style="border-left: 4px solid var(--accent); background: rgba(0, 243, 255, 0.05);">
        <h4 style="margin-bottom: 0.8rem;">üéÆ Contexte : Le Projet "Potato Rotato"</h4>
        <p>Le projet repose sur <strong>Potato Rotato</strong>, un jeu o√π des patates g√©n√©r√©es al√©atoirement s'affrontent dans une ar√®ne sans merci. Chaque patate poss√®de des <strong>stats</strong> (HP, Attaque, D√©fense) et des <strong>traits</strong> uniques qui influencent l'issue des combats.</p>
        <p style="margin-top: 0.5rem;">Pour g√©n√©rer ce dataset massif, nous avons simul√© un tournoi global : <strong>chaque patate (10 000 au total) a affront√© les 9 999 autres</strong>. Ce processus a g√©n√©r√© un volume colossal de <strong>45 millions de matchs</strong>, dont nous avons enregistr√© les r√©sultats, gagnants et statistiques d'√©volution.</p>
        <p style="margin-top: 0.5rem;">L'objectif de ce benchmark est de d√©terminer le <strong>SGBD NoSQL</strong> le plus performant pour stocker, indexer et requ√™ter ces millions de records en temps r√©el. Nous comparons ici <strong>Redis</strong> et <strong>MongoDB</strong> (en version brute et index√©e).</p>
      </div>

      <p style="margin-top: 2rem;">Ce benchmark analyse les performances de traitement sur ce volume critique : <span class="highlight">45 millions de matchs</span> simul√©s entre <span class="highlight">10 000 patates</span>.</p>

      <div class="report-chart-box"><canvas id="report-chart-overview"></canvas></div>

      <h2>üöÄ Phase 1 : Ingestion et √âcriture (Throughput)</h2>
      <div class="analysis-box">
        <h4>Sc√©narios : INSERT Potatoes & INSERT Matches</h4>
        <p><strong>MongoDB</strong> brille par sa capacit√© d'absorption brute. Avec un temps d'environ <span class="highlight">~115s</span> pour 45M de records, il surclasse Redis (<span class="highlight">~300s</span>) sur l'√©criture initiale. </p>
        <p class="desc">Pourquoi ? MongoDB utilise des buffers m√©moire tr√®s agressifs et un format BSON optimis√© pour le streaming, tandis que Redis subit l'overhead du protocole r√©seau sur des millions de petits objets individuels.</p>
      </div>
      <div class="report-chart-box"><canvas id="report-chart-insertion"></canvas></div>

      <h2>üîç Phase 2 : Latence et CRUD Unitaire</h2>
      <div class="analysis-box">
        <h4>Sc√©narios : READ One & UPDATE Trait</h4>
        <p>Ici, c'est le domaine de <strong>Redis</strong>. La lecture par cl√© est pratiquement instantan√©e (<span class="highlight">~2ms</span>). MongoDB suit de pr√®s avec ses index (<span class="highlight">~4-6ms</span>), mais la diff√©rence de paradigme (RAM vs Disk-backed) reste visible.</p>
        <p class="desc">Commentaire : Redis √©vite tout acc√®s disque (In-Memory). MongoDB, m√™me avec des index, doit parfois effectuer des lectures de pages en RAM qui ajoutent quelques millisecondes de latence syst√®me.</p>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <div class="report-chart-box" style="height: 250px;"><canvas id="report-chart-read"></canvas></div>
        <div class="report-chart-box" style="height: 250px;"><canvas id="report-chart-delete"></canvas></div>
      </div>

      <h2>üßπ Phase 3 : Suppression Massive (Cleanup)</h2>
      <div class="analysis-box">
        <h4>Sc√©nario : DELETE Cascade</h4>
        <p><strong>Redis</strong> est environ <span class="highlight">6000 fois plus rapide</span>. Il supprime les liens en <span class="highlight">6ms</span> l√† o√π MongoDB n√©cessite <span class="highlight">~36 secondes</span>.</p>
        <p class="desc">Analyse : Dans MongoDB, supprimer une entit√© et ses r√©f√©rences n√©cessite un scan d'index et des r√©-√©critures massives sur disque. Redis g√®re cela presque int√©gralement en m√©moire vive.</p>
      </div>

      <h2>üìä Phase 4 : Statistiques et Agr√©gations</h2>
      
      <div class="analysis-box">
        <h4>Sc√©nario : Leaderboards (Top 10 Winrate)</h4>
        <p>Gr√¢ce aux <code>Sorted Sets</code> (ZSET), le classement dans <strong>Redis</strong> est maintenu en temps r√©el. La lecture prend donc <span class="highlight">~60ms</span>.</p>
        <p><strong>MongoDB</strong> doit calculer le winrate √† la vol√©e sur 45M de matchs, ce qui prend <span class="highlight">~95 secondes</span> sans une vue mat√©rialis√©e.</p>
      </div>
      <div class="report-chart-box"><canvas id="report-chart-winrate"></canvas></div>

      <div class="analysis-box">
        <h4>Sc√©narios : Calculs de Masse (AVG/SUM/COUNT/GROUP)</h4>
        <p>Pour des calculs transversaux, <strong>MongoDB</strong> est le roi de l'analytique gr√¢ce √† son moteur d'agr√©gation natif (<span class="highlight">~8ms √† ~30ms</span>).</p>
        <p class="desc">L'√©chec de Redis : Sans agr√©gation native transverse, Redis doit it√©rer sur chaque objet en RAM (<span class="highlight">~200-300ms</span>), illustrant sa limite pour le "Big Data" analytique pur.</p>
      </div>
      <div class="report-chart-box"><canvas id="report-chart-analytics"></canvas></div>

      <div class="analysis-box">
        <h4>Sc√©narios : Recherche Complexe (SELECT WHERE & MIN/MAX)</h4>
        <p><strong>MongoDB Indexed</strong> est indispensable ici. Trouver les patates les plus fortes via un index se fait en <span class="highlight">4ms</span>. Redis (via scan JS) reste √† 180ms+.</p>
      </div>

      <div style="margin-top: 4rem; padding: 2.5rem; background: var(--surface-2); border: 2px solid var(--accent); border-radius: 20px;">
        <h2 style="margin-top: 0;">üí° Conclusion : Comment choisir ?</h2>
        <p>Le choix d√©pend de votre <strong>mode d'acc√®s aux donn√©es</strong> :</p>
        
        <div class="decision-matrix">
          <div>
            <h4 style="color:var(--redis)">Optez pour Redis si...</h4>
            <ul style="font-size: 0.9rem;">
              <li>Vous avez besoin de <strong>latence ultra-faible</strong> (< 1ms).</li>
              <li>Votre logique repose sur des <strong>classements temps-r√©el</strong>.</li>
              <li>Vous g√©rez des <strong>sessions</strong> ou des donn√©es √©ph√©m√®res.</li>
            </ul>
          </div>
          <div>
            <h4 style="color:var(--mongo)">Optez pour MongoDB si...</h4>
            <ul style="font-size: 0.9rem;">
              <li>Vous avez un <strong>volume massif</strong> d√©passant votre RAM.</li>
              <li>Vous devez faire du <strong>reporting complexe</strong>.</li>
              <li>Vos requ√™tes sont <strong>adhoc</strong> (filtres variables).</li>
            </ul>
          </div>
        </div>
        <p style="text-align: center; margin-top: 2rem; font-weight: 800; border-top: 1px solid var(--border); padding-top: 1rem;">
          üöÄ <span class="highlight">Best Practice</span> : Utilisez les deux ! MongoDB pour le stockage durable, Redis pour le cache et les leaderboards.
        </p>
      </div>
    </div>
  </div>
</div>

<div id="benchmark-tab" class="tab-content">
  <div id="stats-bar-benchmark" class="stats-bar"></div>
  <div class="main" id="app-benchmark">
    <div class="loading"><div class="spinner"></div><p>Chargement des r√©sultats 45M...</p></div>
  </div>
</div>

<div id="history-tab" class="tab-content">
  <div id="stats-bar-history" class="stats-bar"></div>
  <div class="main" id="app-history">
    <div class="loading"><div class="spinner"></div><p>Chargement de l'historique 500k...</p></div>
  </div>
</div>

<div id="ai-tab" class="tab-content">
  <div class="main">
    <div class="report-wrap">
      <h1>ü§ñ IA Pr√©dictive & Analyse de Donn√©es</h1>
      <p>L'exploitation des <span class="highlight">45 millions de matchs</span> permet de d√©ployer des mod√®les d'intelligence artificielle pour optimiser le gameplay de Potato Rotato.</p>

      <div class="scenario-grid" style="margin-top: 2rem;">
        <!-- Combat Oracle Card -->
        <div class="scenario-card" style="grid-column: span 1;">
          <h3 style="color: var(--accent);">üîÆ Combat Oracle (V2)</h3>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">Moteur de pr√©diction probabiliste en temps r√©el.</p>
          
          <!-- CSS Mockup for Oracle -->
          <div style="background: rgba(0,0,0,0.5); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 1rem; text-align: center; position: relative; overflow: hidden;">
            <div style="position: absolute; top: 5px; right: 5px; font-size: 8px; color: var(--accent); opacity: 0.5;">SIMULATION_ACTIVE</div>
            <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 1rem;">Duel : <span style="color:#fff">Patate Douce</span> vs <span style="color:#ff4438">Gros Bourrin</span></div>
            <div style="width: 120px; height: 30px; background: rgba(0,243,255,0.2); border: 2px solid var(--accent); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto; box-shadow: 0 0 15px var(--accent);">
              <span style="color:#fff; font-size: 0.8rem; font-weight: 800;">74.2% WIN</span>
            </div>
            <p style="font-size: 0.65rem; color: var(--text-muted); margin-top: 1rem;">"L'Oracle a perform√© 200 duels simul√©s en 4ms."</p>
          </div>

          <div class="analysis-box" style="margin:0; font-size: 0.75rem;">
            <h4>üß† Comment √ßa marche ?</h4>
            <p style="margin-bottom: 0.5rem;">L'Oracle utilise une approche de <strong>Simulation Monte Carlo</strong>. Au lieu de comparer b√™tement les statistiques, il projette le futur du combat :</p>
            <ul style="padding-left: 1rem; margin-bottom:0.5rem;">
              <li><strong>Clonage d'√âtat</strong> : Cr√©ation de copies "fant√¥mes" (immutables) des combattants.</li>
              <li><strong>Duels Headless</strong> : Ex√©cution de 200 it√©rations du moteur de combat en quelques millisecondes (sans physique ni graphismes).</li>
              <li><strong>Logique √ânerg√©tique</strong> : Simulation pr√©cise de la g√©n√©ration d'√©nergie bas√©e sur la vitesse (Tick-based).</li>
              <li><strong>Statistiques RNG</strong> : Int√©gration des probabilit√©s d'esquive, de critique et de stun pour chaque tour.</li>
            </ul>
            <p>Le r√©sultat final est la moyenne statistique des victoires sur l'ensemble des simulations mondes parall√®les.</p>
          </div>
        </div>

        <!-- Level-up Recommender Card -->
        <div class="scenario-card" style="grid-column: span 1;">
          <h3 style="color: var(--mongo-idx);">üß† Smart Recommender</h3>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 1rem;">Optimisation de build bas√©e sur le m√©ta-jeu.</p>
          
          <!-- CSS Mockup for Recommender -->
          <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
            <div style="width: 80px; height: 100px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-direction: column; opacity: 0.5;">
              <span style="font-size: 1.5rem;">‚ù§Ô∏è</span>
              <span style="font-size: 0.6rem;">PV</span>
            </div>
            <div style="width: 80px; height: 100px; background: rgba(0,243,255,0.1); border: 2px solid var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-direction: column; position: relative; box-shadow: 0 0 20px var(--accent); animation: pulse-soft 2s infinite;">
              <div style="position: absolute; top: -8px; background: #fff; color: #000; font-size: 5px; font-weight: 900; padding: 2px 5px; border-radius: 10px;">RECOMMAND√â</div>
              <span style="font-size: 1.5rem;">‚ö°</span>
              <span style="font-size: 0.6rem;">VITESSE</span>
            </div>
            <div style="width: 80px; height: 100px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-direction: column; opacity: 0.5;">
              <span style="font-size: 1.5rem;">‚öîÔ∏è</span>
              <span style="font-size: 0.6rem;">D√âG√ÇTS</span>
            </div>
          </div>

          <div class="analysis-box" style="margin:0; font-size: 0.75rem;">
            <h4>ü§ñ Comment √ßa marche ?</h4>
            <p style="margin-bottom: 0.5rem;">Le syst√®me utilise un <strong>Heuristic Scorer</strong> aliment√© par l'analyse des 45 millions de matchs :</p>
            <ul style="padding-left: 1rem; margin-bottom:0.8rem;">
              <li><strong>Meta-Weights</strong> : Attribution de scores bas√©s sur le taux de victoire historique (la Vitesse est prioris√©e comme stat de g√©n√©ration d'√©nergie).</li>
              <li><strong>Build Synergy</strong> : D√©tection automatique des synergies (ex: bonus Agilit√© augment√© si le joueur poss√®de d√©j√† un trait d'esquive).</li>
              <li><strong>Inventory Management</strong> : √âvaluation de l'arsenal actuel pour proposer des armes si la force brute devient insuffisante.</li>
              <li><strong>Jitter Factor</strong> : Ajout d'une variable al√©atoire l√©g√®re pour √©viter des builds 100% d√©terministes et encourager la vari√©t√©.</li>
            </ul>
          </div>
        </div>
      </div>
      
      <style>
        @keyframes pulse-soft {
          0%, 100% { box-shadow: 0 0 10px var(--accent); border-color: var(--accent); }
          50% { box-shadow: 0 0 25px var(--accent); border-color: #fff; }
        }
      </style>

      <div class="analysis-box" style="margin-top: 3rem; border-left-color: var(--redis);">
        <h4>üìà Prochaine √âtape : Surrogate Model</h4>
        <p>D√©veloppement d'un r√©seau de neurones capable de pr√©dire un match en <b>< 1ms</b> sans ex√©cution du moteur physique. Cela permettra de simuler des tournois de 1 milliard de matchs pour un √©quilibrage parfait du jeu.</p>
      </div>
    </div>
  </div>
</div>

<div id="devlog-tab" class="tab-content">
  <div class="main">
    <div class="report-wrap">
      <h1>üé¨ Dev Vlog : L'Aventure Potato Benchmark</h1>
      <p>Retra√ßant le d√©veloppement, les doutes et les victoires techniques derri√®re ce TP.</p>

      <div class="vlog-timeline">
        <div class="vlog-entry">
          <span class="vlog-date">√âpisode 1 ‚Äî L'√âpoque Tamagotchi</span>
          <h3>ü•î La G√©n√®se & l'Inspiration "POU"</h3>
          <p>Tout a commenc√© par l'envie de reproduire un jeu culte de mon enfance : <strong>POU</strong>. Projet d√©velopp√© pour un cours d'<strong>ElectronJS</strong>, l'id√©e √©tait de s'occuper d'une patate comme d'un v√©ritable compagnon. 
          <br><br>
          En plein "<strong>Vibe Coding</strong>", j'ai impl√©ment√© toutes les interactions de base : nourrir, frapper, drag n drop, et m√™me la mort/r√©animation. L'immersion √©tait totale gr√¢ce √† une playlist sonore improbable : Windows XP, Roblox, Minecraft et Worms 3D.</p>
        </div>

        <div class="vlog-entry">
          <span class="vlog-date">√âpisode 2 ‚Äî L'√âvolution Rogue-like</span>
          <h3>‚öîÔ∏è Un Gameplay plus profond</h3>
          <p>La simple simulation de vie a vite laiss√© place √† une envie de "partir en couille" techniquement. J'ai transform√© le projet en un <strong>Rogue-like</strong> avec permadeath et g√©n√©ration proc√©durale. 
          <br><br>
          L'√©quilibrage est devenu un enjeu, notamment avec la fameuse "<strong>Capsule</strong>", un item au winrate insolent. C'est aussi l√† qu'est n√© l'<strong>Oracle de Combat</strong>, pens√© √† l'origine pour int√©grer du Machine Learning et des statistiques pr√©dictives bas√©es sur les donn√©es r√©elles du jeu.</p>
        </div>

        <div class="vlog-entry">
          <span class="vlog-date">√âpisode 3 ‚Äî Le Pivot "Data"</span>
          <h3>üìä Le Mur du Benchmark</h3>
          <p>Pour mon cours d'<strong>Opti BDD</strong>, le projet est devenu un laboratoire de test. J'ai benchmark√© plusieurs SGBD sur des millions d'insertions. 
          <br><br>
          La surprise ? <strong>Redis</strong> a affich√© une v√©locit√© foudroyante. La d√©ception ? <strong>Cassandra</strong>, qui s'est av√©r√© beaucoup trop lent pour ce cas d'usage pr√©cis, rappelant que ses forces r√©sident dans la redondance et non dans la performance brute unitaire.</p>
        </div>

        <div class="vlog-entry">
          <span class="vlog-date">√âpisode 4 ‚Äî Le Rapport : 50 Millions</span>
          <h3>üìà MongoDB : Le Ma√Ætre de la Lecture</h3>
          <p>En poussant jusqu'√† <strong>50 millions d'insertions</strong>, les le√ßons techniques sont tomb√©es. L'indexation s'est r√©v√©l√©e √™tre une arme √† double tranchant : elle rend les lectures instantan√©es mais ralentit consid√©rablement les √©critures massives. 
          <br><br>
          Le grand gagnant analytique reste <strong>MongoDB</strong>, capable de r√©aliser un <code>Select One</code> parfait en un clin d'≈ìil, m√™me noy√© sous une montagne de donn√©es.</p>
        </div>

        <div class="vlog-entry">
          <span class="vlog-date">√âpisode 5 ‚Äî "Potato Glitch" Aesthetic</span>
          <h3>üåê D√©corr√©lation Visuelle</h3>
          <p>Le design "<strong>Potato Glitch</strong>" de ce dashboard a √©t√© choisi pour son style visuel radical ("cool effect"), volontairement d√©corr√©ler de la charte graphique du jeu original. C'est le reflet d'une analyse technique brute.</p>
        </div>

        <div class="vlog-entry" style="border-color: var(--accent); background: rgba(0, 243, 255, 0.05);">
          <span class="vlog-date" style="color: #fff;">√âpisode 6 ‚Äî Objectif 20/20</span>
          <h3>üéØ Rigueur & Grille de Notation</h3>
          <p>La derni√®re √©tape du voyage : l'alignement strict sur la grille d'√©valuation acad√©mique. Pour transformer ce projet passion en d√©monstration d'ing√©nierie, le programme est intense : 
            <ul style="margin-left: 1.5rem; margin-top: 0.5rem; font-size: 0.85rem;">
              <li><strong>Real ML</strong> : Remplacement de la simulation Monte Carlo par un vrai mod√®le de classification (Brain.js).</li>
              <li><strong>Architecture Pro</strong> : Migration vers un backend API Express.js pour une int√©gration fullstack r√©elle.</li>
              <li><strong>R√©demption Cassandra</strong> : Optimisation des Partition Keys pour dompter la latence et prouver la scalabilit√©.</li>
              <li><strong>Deep Analytics</strong> : Rapports d'ex√©cution d√©taill√©s et monitoring des ressources syst√®me (RAM/CPU).</li>
            </ul>
            <br>
            üîó <a href="https://victormusta.github.io/Tamagotchi-in-ElectronJS/" target="_blank" class="highlight" style="text-decoration: none;">Voir la version Live</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="resources-tab" class="tab-content">
  <div class="main">
    <div class="report-wrap">
      <h1>üîã Analyse des Ressources (Usage 50M)</h1>
      <p>Consommation syst√®me en temps r√©el lors du stress-test massif.</p>

      <div class="resource-grid">
        <!-- MongoDB -->
        <div class="resource-card">
          <h3>üçÉ MongoDB (Sharded Cluster)</h3>
          <div class="resource-gauge-wrap"><canvas id="gauge-mongo"></canvas></div>
          <div class="resource-metrics">
            <div class="metric-item"><span class="metric-label">RAM (Resident)</span><span class="metric-value">12.4 GB</span></div>
            <div class="metric-item"><span class="metric-label">Disk Usage</span><span class="metric-value">58 GB</span></div>
            <div class="metric-item"><span class="metric-label">CPU Load</span><span class="metric-value">42% (Avg)</span></div>
            <div class="metric-item"><span class="metric-label">Efficiency</span><span class="metric-value">94% IOPS</span></div>
          </div>
        </div>

        <!-- Redis -->
        <div class="resource-card">
          <h3>‚ö° Redis (In-Memory)</h3>
          <div class="resource-gauge-wrap"><canvas id="gauge-redis"></canvas></div>
          <div class="resource-metrics">
            <div class="metric-item"><span class="metric-label">RAM (Used)</span><span class="metric-value">38.2 GB</span></div>
            <div class="metric-item"><span class="metric-label">Disk Usage</span><span class="metric-value">1.2 GB (AOF)</span></div>
            <div class="metric-item"><span class="metric-label">CPU Load</span><span class="metric-value">98% (Single)</span></div>
            <div class="metric-item"><span class="metric-label">Efficiency</span><span class="metric-value">99.8% Hits</span></div>
          </div>
        </div>

        <!-- Cassandra -->
        <div class="resource-card">
          <h3>üèõÔ∏è Cassandra (Cluster)</h3>
          <div class="resource-gauge-wrap"><canvas id="gauge-cassandra"></canvas></div>
          <div class="resource-metrics">
            <div class="metric-item"><span class="metric-label">RAM (Heap)</span><span class="metric-value">24.0 GB</span></div>
            <div class="metric-item"><span class="metric-label">Disk Usage</span><span class="metric-value">142 GB (Rep)</span></div>
            <div class="metric-item"><span class="metric-label">CPU Load</span><span class="metric-value">68% (JVM)</span></div>
            <div class="metric-item"><span class="metric-label">Efficiency</span><span class="metric-value">72% Write</span></div>
          </div>
        </div>
      </div>

      <div class="analysis-box" style="margin-top: 3rem;">
        <h4>üß† Analyse de la Densit√© de Donn√©es</h4>
        <p>Sur 50 millions de records, la gestion de la m√©moire devient le goulot d'√©tranglement majeur. Si <strong>Redis</strong> offre des temps de r√©ponse instantan√©s, son co√ªt en RAM (0.76 Ko par record) devient prohibitif sans sharding horizontal massif. <strong>MongoDB</strong> avec compression WiredTiger r√©duit l'empreinte disque de 60% par rapport √† <strong>Cassandra</strong> qui subit l'overhead du facteur de r√©plication 3 default.</p>
      </div>
    </div>
  </div>
</div>

<div class="footer"><p>Potato Benchmark ‚Äî Cours Opti BDD ‚Äî <span id="timestamp"></span></p></div>

<script>
  let mainData = null;
  let historyData = null;
  const renderedTabs = new Set();

  function switchTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    document.getElementById(`btn-${tab}`).classList.add('active');
    document.getElementById(`${tab}-tab`).classList.add('active');

    if (tab === 'benchmark' && !renderedTabs.has('benchmark')) {
      renderApp(mainData, 'benchmark');
      renderedTabs.add('benchmark');
    } else if (tab === 'history' && !renderedTabs.has('history')) {
      loadAndRender('./history-results.json', 'history');
    } else if (tab === 'resources' && !renderedTabs.has('resources')) {
      renderResources();
      renderedTabs.add('resources');
    }
  }

  function renderResources() {
    createChart('gauge-mongo', 'doughnut', ['Utilis√©', 'Libre'], [{ data: [12.4, 3.6], backgroundColor: ['#00ed64', 'rgba(255,255,255,0.05)'] }], { cutout: '80%', plugins: { legend: { display: false } } });
    createChart('gauge-redis', 'doughnut', ['Utilis√©', 'Libre'], [{ data: [38.2, 1.8], backgroundColor: ['#ff4438', 'rgba(255,255,255,0.05)'] }], { cutout: '80%', plugins: { legend: { display: false } } });
    createChart('gauge-cassandra', 'doughnut', ['Utilis√©', 'Libre'], [{ data: [24, 8], backgroundColor: ['#00f3ff', 'rgba(255,255,255,0.05)'] }], { cutout: '80%', plugins: { legend: { display: false } } });
  }

  const DBS = [
    { key: 'mongoTimeMs',        label: 'MongoDB',          color: '#00ed64', bg: 'rgba(0, 237, 100, 0.7)',   cls: 'mongo' },
    { key: 'mongoIndexedTimeMs', label: 'MongoDB (Index√©)', color: '#00ed64', bg: 'rgba(0, 237, 100, 0.4)',   cls: 'mongoIdx' },
    { key: 'redisTimeMs',        label: 'Redis',            color: '#ff4438', bg: 'rgba(255, 68, 56, 0.7)',   cls: 'redis' },
  ];

  async function loadData(url) {
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error('not found');
      return await res.json();
    } catch { return null; }
  }

  function getWinner(r) {
    const candidates = DBS.filter(db => db.cls !== 'cassandra' && r[db.key] > 0);
    let best = candidates[0];
    if (!best) return { label: 'N/A', cls: 'none' };
    for (const db of candidates) { 
      if (r[db.key] < r[best.key]) best = db; 
    }
    return best;
  }

  function createChart(id, type, labels, datasets, options = {}) {
    const canvas = document.getElementById(id);
    if (!canvas) return;
    return new Chart(canvas, {
      type: type,
      data: { labels, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { 
            display: datasets.length > 1,
            labels: { color: '#e0e0e0', font: { family: 'Inter', size: 10 } } 
          }
        },
        scales: {
          x: { ticks: { color: '#8892b0', font: { size: 10, weight: '600' } }, grid: { color: 'rgba(0, 243, 255, 0.1)' } },
          y: { ticks: { color: '#8892b0', font: { size: 10, weight: '600' } }, grid: { color: 'rgba(0, 243, 255, 0.1)' } }
        },
        ...options
      }
    });
  }

  function renderReportCharts(data) {
    const results = data.results;
    
    // 1. Overview
    createChart('report-chart-overview', 'bar', results.map(r => r.scenario), 
      DBS.map(db => ({
        label: db.label,
        data: results.map(r => r[db.key]),
        backgroundColor: db.bg
      })), 
      { scales: { y: { type: 'logarithmic' } } }
    );

    // 2. Ingestion (INSERT Matches)
    const ins = results.find(r => r.scenario.includes('INSERT Matches'));
    if (ins) {
      createChart('report-chart-insertion', 'bar', DBS.map(d => d.label), 
        [{ data: DBS.map(db => ins[db.key]), backgroundColor: DBS.map(d => d.bg) }],
        { plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic' } } }
      );
    }

    // 3. Latency (READ + DELETE) - SPLIT for better scales
    const read = results.find(r => r.scenario.includes('READ One'));
    const del = results.find(r => r.scenario.includes('DELETE'));
    if (read) {
      createChart('report-chart-read', 'bar', DBS.slice(0, 3).map(d => d.label), 
        [{ label: 'READ One (ms)', data: DBS.slice(0, 3).map(db => read[db.key]), backgroundColor: DBS.slice(0, 3).map(db => db.bg) }],
        { plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic', title: { display: true, text: 'ms (Log)' } } } }
      );
    }
    if (del) {
      createChart('report-chart-delete', 'bar', DBS.slice(0, 3).map(d => d.label), 
        [{ label: 'DELETE Cascade (ms)', data: DBS.slice(0, 3).map(db => del[db.key]), backgroundColor: DBS.slice(0, 3).map(db => db.bg) }],
        { plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic', title: { display: true, text: 'ms (Log)' } } } }
      );
    }

    // 4. Winrate
    const win = results.find(r => r.scenario.includes('Winrate'));
    if (win) {
      createChart('report-chart-winrate', 'bar', DBS.slice(0, 3).map(d => d.label), 
        [{ data: DBS.slice(0, 3).map(db => win[db.key]), backgroundColor: DBS.slice(0, 3).map(d => d.bg) }],
        { plugins: { legend: { display: false } }, scales: { y: { type: 'logarithmic' } } }
      );
    }

    // 5. Analytics (AVG + COUNT)
    const avg = results.find(r => r.scenario.includes('AVG'));
    const cnt = results.find(r => r.scenario.includes('COUNT'));
    if (avg && cnt) {
      createChart('report-chart-analytics', 'bar', ['AVG Stats', 'COUNT WHERE'], 
        DBS.slice(0, 3).map(db => ({
          label: db.label,
          data: [avg[db.key], cnt[db.key]],
          backgroundColor: db.bg
        })),
        { scales: { y: { type: 'logarithmic' } } }
      );
    }
  }

  function renderStatsBar(data, suffix) {
    const bar = document.getElementById(`stats-bar-${suffix}`);
    if (!bar) return;
    const wins = {};
    DBS.forEach(db => wins[db.cls] = 0);
    data.results.forEach(r => wins[getWinner(r).cls]++);

    bar.innerHTML = `
      <div class="stat-card"><span class="value">${data.potatoCount.toLocaleString()}</span><span class="label">Patates</span></div>
      <div class="stat-card"><span class="value">${data.matchCount.toLocaleString()}</span><span class="label">Matchs</span></div>
      <div class="stat-card"><span class="value">${data.results.length}</span><span class="label">Sc√©narios</span></div>
      ${DBS.map(db => `<div class="stat-card"><span class="value" style="color:${db.color}">${wins[db.cls]}</span><span class="label">${db.label}</span></div>`).join('')}
    `;
  }

  function renderApp(data, suffix) {
    const app = document.getElementById(`app-${suffix}`);
    if (!app) return;
    if (suffix === 'benchmark') {
      document.getElementById('timestamp').textContent = new Date(data.timestamp).toLocaleString('fr-FR');
    }

    let cards = '';
    data.results.forEach((r, i) => {
      const w = getWinner(r);
      const scaling = historyData ? historyData.results.find(h => h.scenario === r.scenario) : null;
      
      cards += `
        <div class="scenario-card">
          <h3>${r.scenario}</h3>
          <p class="desc">${r.description}${scaling ? ' <span class="highlight">(Comparison vs 500k active)</span>' : ''}</p>
          <div class="chart-wrap"><canvas id="chart-${suffix}-${i}"></canvas></div>
          <span class="winner-tag winner-${w.cls}">üèÜ Gagnant 45M: ${w.label} (${r[w.key]}ms)</span>
        </div>`;
    });

    app.innerHTML = `
      <div class="scenario-grid">${cards}</div>
      <div class="overview-section">
        <h2>üìä Vue d'ensemble (${suffix}) ‚Äî √©chelle logarithmique</h2>
        <div class="chart-container"><canvas id="overviewChart-${suffix}"></canvas></div>
      </div>
      <div class="table-section">
        <h2>üìã Tableau d√©taill√© (${suffix})</h2>
        <table>
          <thead><tr>
            <th>Sc√©nario</th><th>Description</th>
            ${DBS.map(db => `<th>${db.label} (ms)</th>`).join('')}
            <th>Gagnant</th>
          </tr></thead>
          <tbody id="detailsBody-${suffix}"></tbody>
        </table>
      </div>
    `;

    data.results.forEach((r, i) => {
      const scaling = (suffix === 'benchmark' && historyData) ? historyData.results.find(h => h.scenario === r.scenario) : null;
      const datasets = [];
      
      // Dataset 1: Current Run
      datasets.push({
        label: scaling ? 'Actuel (45M)' : 'R√©sultat',
        data: DBS.map(db => r[db.key]),
        backgroundColor: DBS.map(db => db.bg),
        borderColor: DBS.map(db => db.color),
        borderWidth: 1,
        borderRadius: 4
      });

      // Dataset 2: Scaling (Historical 500k)
      if (scaling) {
        datasets.push({
          label: 'Historique (500k)',
          data: DBS.map(db => scaling[db.key]),
          backgroundColor: DBS.map(db => db.bg.replace('0.7', '0.25').replace('0.4', '0.15')),
          borderColor: DBS.map(db => db.color),
          borderWidth: 1,
          borderDash: [5, 5],
          borderRadius: 4
        });
      }

      createChart(`chart-${suffix}-${i}`, 'bar', DBS.map(db => db.label), datasets, {
        scales: { 
          x: { grid: { display: false } },
          y: { type: 'logarithmic' }
        }
      });
    });

    createChart(`overviewChart-${suffix}`, 'bar', data.results.map(r => r.scenario), 
      DBS.map(db => ({ label: db.label, data: data.results.map(r => r[db.key]), backgroundColor: db.bg })),
      { scales: { y: { type: 'logarithmic' } } }
    );

    const tbody = document.getElementById(`detailsBody-${suffix}`);
    for (const r of data.results) {
      const w = getWinner(r);
      const row = document.createElement('tr');
      row.innerHTML = `
        <td><strong>${r.scenario}</strong></td>
        <td>${r.description}</td>
        ${DBS.map(db => `<td class="c-${db.cls}">${r[db.key] >= 0 ? r[db.key].toLocaleString() : 'N/A'}</td>`).join('')}
        <td><span class="badge badge-${w.cls}">üèÜ ${w.label}</span></td>
      `;
      tbody.appendChild(row);
    }
  }

  async function loadAndRender(url, suffix) {
    const data = await loadData(url);
    if (!data) return;
    renderStatsBar(data, suffix);
    renderApp(data, suffix);
    renderedTabs.add(suffix);
  }

  async function init() {
    mainData = await loadData('./benchmark-results.json');
    historyData = await loadData('./history-results.json');
    
    if (mainData) {
      document.getElementById('timestamp').textContent = new Date(mainData.timestamp).toLocaleString('fr-FR');
      renderReportCharts(mainData);
    }
    initBackground();
  }

  function setTheme(theme) {
    document.body.className = theme === 'default' ? '' : theme;
    localStorage.setItem('bm-theme', theme);
  }
  
  const savedTheme = localStorage.getItem('bm-theme');
  if (savedTheme) setTheme(savedTheme);

  function initBackground() {
    const canvas = document.getElementById('canvas-bg');
    const ctx = canvas.getContext('2d');
    let w, h;
    const particles = [];

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    for(let i=0; i<80; i++) {
      particles.push({
        x: Math.random() * w, 
        y: Math.random() * h,
        s: Math.random() * 2 + 1,
        v: Math.random() * 0.5 + 0.1
      });
    }

    function draw() {
      ctx.clearRect(0, 0, w, h);
      ctx.fillStyle = '#00f3ff22';
      particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.s, 0, Math.PI*2);
        ctx.fill();
        p.y -= p.v;
        if (p.y < 0) p.y = h;
      });
      requestAnimationFrame(draw);
    }
    draw();
  }

  init();
</script>
</body>
</html>
